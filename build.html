<!DOCTYPE html>
<html lang="en" class="wa-cloak">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Build Your PRISM - MTG Deck Sleeve Marking Tool</title>
    <script src="https://kit.webawesome.com/da021fed1e5141f2.js" crossorigin="anonymous"></script>
    <link rel="icon" type="image/x-icon" href="./assets/Prism-Small-Icon-Invert.svg">
    <script>
      // Always dark mode
      document.documentElement.classList.add('wa-dark');
    </script>
    <link rel="stylesheet" href="custom.css" />
  </head>
  <body>
    <wa-page disable-navigation-toggle="true" mobile-breakpoint="475">
      <!-- Header -->
      <header slot="header" class="wa-split">
        <div class="wa-cluster wa-gap-m wa-align-items-center">
          <a href="index.html" class="wa-cluster wa-gap-xs wa-align-items-center" style="text-decoration: none; color: inherit;">
            <img src="./assets/Prism-Small-Icon-Invert.svg" alt="Prism Logo" style="height:1.5em;">
            <span class="wa-heading-m wa-desktop-only">PRISM</span>
          </a>
        </div>
        <div class="wa-cluster wa-gap-xs wa-align-items-center">
          <wa-button id="btn-new-prism" appearance="outlined" variant="neutral" size="small">
            <wa-icon slot="start" name="plus"></wa-icon>
            New PRISM
          </wa-button>
        </div>
      </header>

      <main class="wa-stack wa-gap-xl">
        <!-- PRISM Name -->
        <section class="wa-stack wa-gap-s">
          <div class="wa-split wa-align-items-center">
            <div class="wa-cluster wa-gap-s wa-align-items-center">
            <img src="./assets/Prism-Small-Icon-Invert.svg" alt="Prism Logo" style="height:1.5em;">
              <wa-input 
                id="prism-name" 
                placeholder="My PRISM" 
                size="large"
                style="--wa-input-border-width: 0; font-weight: 600;"
              ></wa-input>
            </div>
            <wa-tag id="deck-count-tag" variant="neutral" size="small">0/32 decks</wa-tag>
          </div>
        </section>

        <!-- Tab Navigation -->
        <wa-tab-group id="main-tabs">
          <wa-tab slot="nav" panel="decks">
            <wa-icon name="layer-group" style="margin-right: 0.5em;"></wa-icon>
            Decks
          </wa-tab>
          <wa-tab slot="nav" panel="results">
            <wa-icon name="table" style="margin-right: 0.5em;"></wa-icon>
            Results
          </wa-tab>
          <wa-tab slot="nav" panel="export">
            <wa-icon name="download" style="margin-right: 0.5em;"></wa-icon>
            Export
          </wa-tab>
          <wa-tab slot="nav" panel="import">
            <wa-icon name="upload" style="margin-right: 0.5em;"></wa-icon>
            Import
          </wa-tab>

          <!-- Decks Panel -->
          <wa-tab-panel name="decks">
            <div class="wa-stack wa-gap-xl">
              <!-- Existing Decks List -->
              <section id="decks-list" class="wa-stack wa-gap-m">
                <!-- Deck cards will be inserted here -->
              </section>

              <!-- Reorder Stripes -->
              <wa-card id="reorder-card" style="display: none;">
                <div slot="header" class="wa-cluster wa-gap-s wa-align-items-center">
                  <wa-icon name="arrows-up-down" style="color: var(--wa-color-brand-fill);"></wa-icon>
                  <span class="wa-heading-m">Reorder Stripe Positions</span>
                </div>
                <p class="wa-caption-m" style="margin-bottom: var(--wa-space-m);">
                  Use the arrows to change stripe positions. Position 1 is at the top of the sleeve edge.
                </p>
                <div id="stripe-reorder-list" class="wa-stack wa-gap-xs">
                  <!-- Reorder items will be inserted here -->
                </div>
              </wa-card>

              <!-- Add Deck Form -->
              <wa-card id="add-deck-card">
                <div slot="header" class="wa-cluster wa-gap-s wa-align-items-center">
                  <wa-icon name="plus-circle" style="color: var(--wa-color-brand-fill);"></wa-icon>
                  <span class="wa-heading-m">Add a Deck</span>
                </div>

                <form id="deck-form" class="wa-stack wa-gap-l">
                  <div class="wa-grid wa-gap-m" style="--min-column-size: 200px;">
                    <wa-input 
                      id="deck-name" 
                      label="Deck Name" 
                      placeholder="e.g., Izzet Spellslinger" 
                      required
                    ></wa-input>
                    
                    <wa-input 
                      id="deck-commander" 
                      label="Commander" 
                      placeholder="e.g., Alania, Divergent Storm" 
                      required
                    ></wa-input>
                  </div>

                  <wa-radio-group
                    id="deck-bracket"
                    label="Bracket (Power Level)"
                    orientation="horizontal"
                    value="2"
                  >
                    <wa-radio appearance="button" value="1">1</wa-radio>
                    <wa-radio appearance="button" value="2">2</wa-radio>
                    <wa-radio appearance="button" value="3">3</wa-radio>
                    <wa-radio appearance="button" value="4">4</wa-radio>
                    <wa-radio appearance="button" value="5">5</wa-radio>
                  </wa-radio-group>

                  <div class="wa-flank wa-align-items-start">
                    <div class="wa-stack wa-gap-xs style="--flank-size:175px;">
                      <label class="wa-caption-m">Current Marker</label>
                        <input type="color" id="deck-color" value="#ecc933" title="Pick a custom color" style="width: 40px; height: 32px; border: 2px dashed var(--wa-color-neutral-stroke); border-radius: var(--wa-border-radius-m); cursor: pointer;" />
                        <div id="color-warning" class="wa-caption-s" style="color: var(--wa-color-warning-text); display: none;">
                          <wa-icon name="triangle-exclamation" style="font-size: 0.9em;"></wa-icon>
                        </div>
                    </div>
                    <div class="wa-stack wa-gap-xs">
                      <label class="wa-caption-m">Select a Color</label>
                      <div class="wa-cluster wa-gap-s wa-align-items-center">
                       <div id="color-swatches" class="wa-cluster wa-gap-xs">
                         <!-- Color swatches will be inserted here -->
                        </div>
                        <wa-divider vertical style="height: 12px;"></wa-divider>
                      </div>
                    
                    </div>
                  </div>


                  <div class="wa-stack wa-gap-xs">
                    <label class="wa-caption-m">Decklist</label>
                    <div class="wa-cluster wa-gap-s wa-align-items-center">
                      <wa-button type="button" id="btn-upload-file" variant="neutral" appearance="outlined" size="small">
                        <wa-icon slot="start" name="file-arrow-up"></wa-icon>
                        Upload .txt
                      </wa-button>
                      <input type="file" id="deck-file-input" accept=".txt,.dec,.dek,.mwDeck" style="display: none;" />
                      <span id="file-name-display" class="wa-caption-s" style="color: var(--wa-color-neutral-text-subtle);"></span>
                    </div>
                  </div>

                  <wa-textarea
                    id="deck-list"
                    placeholder="1 Sol Ring&#10;1 Arcane Signet&#10;1 Command Tower&#10;12 Island&#10;..."
                    rows="8"
                    required
                  ></wa-textarea>

                  <wa-divider style="--spacing: 0.5rem;"></wa-divider>

                  <wa-details>
                    <span slot="summary" class="wa-caption-m">
                      <wa-icon name="link" style="margin-right: 0.5em;"></wa-icon>
                      Import from Moxfield
                    </span>
                    <div class="wa-stack wa-gap-m" style="padding-top: var(--wa-space-s);">
                      <wa-callout variant="neutral">
                        <wa-icon slot="icon" name="circle-info"></wa-icon>
                        <strong>How to import from Moxfield:</strong>
                        <ol style="margin: var(--wa-space-xs) 0 0 var(--wa-space-m); padding: 0;">
                          <li>Open your deck on Moxfield</li>
                          <li>Click the <strong>Export</strong> button (top right)</li>
                          <li>Select <strong>Text</strong> format</li>
                          <li>Copy the text and paste it above, or save as .txt and upload</li>
                        </ol>
                      </wa-callout>
                      <div class="wa-caption-s" style="color: var(--wa-color-neutral-text-subtle);">
                        Direct Moxfield import coming soon.
                      </div>
                    </div>
                  </wa-details>

                  <div id="parse-errors" class="wa-stack wa-gap-xs" style="display: none;">
                    <!-- Parse errors will be shown here -->
                  </div>

                  <div class="wa-cluster wa-gap-s">
                    <wa-button type="submit" variant="brand">
                      <wa-icon slot="start" name="plus"></wa-icon>
                      Add Deck
                    </wa-button>
                    <wa-button type="button" id="btn-reset-form" variant="neutral" appearance="outlined">
                      Reset
                    </wa-button>
                  </div>
                </form>
              </wa-card>
            </div>
          </wa-tab-panel>

          <!-- Results Panel -->
          <wa-tab-panel name="results">
            <div class="wa-stack wa-gap-l">
              <!-- Stats Summary -->
              <div id="results-stats" class="wa-grid wa-gap-m" style="--min-column-size: 150px;">
                <wa-card appearance="filled">
                  <div class="wa-stack wa-gap-2xs wa-align-items-center">
                    <span class="wa-heading-3xl" id="stat-total">0</span>
                    <span class="wa-caption-m">Total Cards</span>
                  </div>
                </wa-card>
                <wa-card appearance="filled">
                  <div class="wa-stack wa-gap-2xs wa-align-items-center">
                    <span class="wa-heading-3xl" id="stat-shared">0</span>
                    <span class="wa-caption-m">Shared (2+ Decks)</span>
                  </div>
                </wa-card>
              </div>

              <!-- Filter -->
              <div class="wa-cluster wa-gap-m wa-align-items-center" style="flex-wrap: wrap;">
                <wa-radio-group id="results-filter" orientation="horizontal" value="all">
                  <wa-radio appearance="button" value="all">All Cards</wa-radio>
                  <wa-radio appearance="button" value="shared">Shared (2+ Decks)</wa-radio>
                  <wa-radio appearance="button" value="basics-by-deck">Basics by Deck</wa-radio>
                </wa-radio-group>

                <!-- Deck Filter Dropdown -->
                <wa-dropdown id="deck-filter-dropdown" stay-open-on-select>
                  <wa-button slot="trigger" variant="neutral" size="small" caret>
                    <wa-icon slot="start" name="filter"></wa-icon>
                    Filter by Deck
                  </wa-button>
                  <wa-menu id="deck-filter-menu">
                    <!-- Deck checkboxes will be dynamically inserted here -->
                  </wa-menu>
                </wa-dropdown>

                <wa-switch id="show-all-slots" size="small">Show all slots</wa-switch>
              </div>

              <!-- Search -->
              <wa-input id="results-search" placeholder="Search cards..." size="medium" style="max-width: 400px;">
                <wa-icon slot="start" name="search"></wa-icon>
              </wa-input>

              <!-- Results Table -->
              <div id="results-table-container" style="overflow-x: auto;">
                <table id="results-table" class="results-table">
                  <thead>
                    <tr>
                      <th>Card Name</th>
                      <th>Stripes</th>
                      <th style="width: 60px;">Done</th>
                    </tr>
                  </thead>
                  <tbody id="results-tbody">
                    <!-- Results will be inserted here -->
                  </tbody>
                </table>
              </div>

              <div id="no-results" class="wa-stack wa-gap-m wa-align-items-center" style="padding: var(--wa-space-2xl); display: none;">
                <wa-icon name="inbox" style="font-size: 3rem; color: var(--wa-color-neutral-text-subtle);"></wa-icon>
                <p style="color: var(--wa-color-neutral-text-subtle);">Add some decks to see your card analysis here.</p>
                <wa-button variant="brand" id="btn-go-to-decks">
                  <wa-icon slot="start" name="plus"></wa-icon>
                  Add Your First Deck
                </wa-button>
              </div>
            </div>
          </wa-tab-panel>

          <!-- Export Panel -->
          <wa-tab-panel name="export">
            <div class="wa-stack wa-gap-xl">
              <!-- Deck Legend -->
              <wa-card>
                <div slot="header" class="wa-heading-m">Deck Legend</div>
                <div id="deck-legend" class="wa-cluster wa-gap-m">
                  <!-- Deck legend items will be inserted here -->
                </div>
                <div id="no-decks-legend" style="color: var(--wa-color-neutral-text-subtle);">
                  No decks added yet.
                </div>
              </wa-card>

              <!-- Export Options -->
              <wa-card>
                <div slot="header" class="wa-heading-m">Export Options</div>
                <div class="wa-cluster wa-gap-m">
                  <wa-button id="btn-export-csv" variant="neutral">
                    <wa-icon slot="start" name="file-csv"></wa-icon>
                    Download CSV
                  </wa-button>
                  <wa-button id="btn-export-json" variant="neutral">
                    <wa-icon slot="start" name="file-code"></wa-icon>
                    Download JSON
                  </wa-button>
                  <wa-button id="btn-print-guide" variant="neutral">
                    <wa-icon slot="start" name="print"></wa-icon>
                    Printable Guide
                  </wa-button>
                </div>
              </wa-card>

              
            </div>
          </wa-tab-panel>

          <wa-tab-panel name="import">
          <!-- Import Options -->
              <wa-card>
                <div slot="header" class="wa-cluster wa-gap-s wa-align-items-center">
                  <wa-icon name="file-import" style="color: var(--wa-color-brand-fill);"></wa-icon>
                  <span class="wa-heading-m">Import Saved PRISM</span>
                </div>
                <div class="wa-stack wa-gap-m">
                  <p class="wa-caption-m" style="color: var(--wa-color-neutral-text-subtle);">
                    Import a previously exported PRISM JSON file to restore your decks and settings.
                  </p>
                  <div class="wa-cluster wa-gap-s wa-align-items-center">
                    <wa-button id="btn-import-json" variant="neutral" appearance="outlined">
                      <wa-icon slot="start" name="file-arrow-up"></wa-icon>
                      Import JSON
                    </wa-button>
                    <input type="file" id="prism-json-input" accept=".json" style="display: none;" />
                    <span id="import-status" class="wa-caption-s" style="color: var(--wa-color-neutral-text-subtle);"></span>
                  </div>
                </div>
              </wa-card>

          </wa-tab-panel>
        </wa-tab-group>
      </main>
    </wa-page>

    <!-- Delete Confirmation Dialog -->
    <wa-dialog id="delete-dialog" label="Delete Deck">
      <p>Are you sure you want to delete <strong id="delete-deck-name"></strong>?</p>
      <p style="color: var(--wa-color-neutral-text-subtle);">This action cannot be undone.</p>
      <div slot="footer" class="wa-cluster wa-gap-s">
        <wa-button id="btn-cancel-delete" variant="neutral" appearance="outlined">Cancel</wa-button>
        <wa-button id="btn-confirm-delete" variant="danger">Delete</wa-button>
      </div>
    </wa-dialog>

    <!-- New PRISM Confirmation Dialog -->
    <wa-dialog id="new-prism-dialog" label="Create New PRISM">
      <p>This will create a new empty PRISM. Your current PRISM will be saved and can be accessed later.</p>
      <div slot="footer" class="wa-cluster wa-gap-s">
        <wa-button id="btn-cancel-new" variant="neutral" appearance="outlined">Cancel</wa-button>
        <wa-button id="btn-confirm-new" variant="brand">Create New</wa-button>
      </div>
    </wa-dialog>

    <!-- Edit Deck Dialog -->
    <wa-dialog id="edit-dialog" label="Edit Deck" style="--width: 600px;">
      <form id="edit-deck-form" class="wa-stack wa-gap-l">
        <input type="hidden" id="edit-deck-id" />

        <div class="wa-grid wa-gap-m" style="--min-column-size: 200px;">
          <wa-input
            id="edit-deck-name"
            label="Deck Name"
            required
          ></wa-input>

          <wa-input
            id="edit-deck-commander"
            label="Commander"
            required
          ></wa-input>
        </div>

        <wa-radio-group
          id="edit-deck-bracket"
          label="Bracket (Power Level)"
          orientation="horizontal"
          value="2"
        >
          <wa-radio appearance="button" value="1">1</wa-radio>
          <wa-radio appearance="button" value="2">2</wa-radio>
          <wa-radio appearance="button" value="3">3</wa-radio>
          <wa-radio appearance="button" value="4">4</wa-radio>
          <wa-radio appearance="button" value="5">5</wa-radio>
        </wa-radio-group>

        <div class="wa-stack wa-gap-xs">
          <label class="wa-caption-m">Marker Color</label>
          <input type="color" id="edit-deck-color" style="width: 60px; height: 40px; border: none; border-radius: var(--wa-border-radius-m); cursor: pointer;" />
        </div>

        <div class="wa-stack wa-gap-xs">
          <label class="wa-caption-m">Decklist</label>
          <div class="wa-cluster wa-gap-s wa-align-items-center">
            <wa-button type="button" id="btn-edit-upload-file" variant="neutral" appearance="outlined" size="small">
              <wa-icon slot="start" name="file-arrow-up"></wa-icon>
              Upload .txt
            </wa-button>
            <input type="file" id="edit-deck-file-input" accept=".txt,.dec,.dek,.mwDeck" style="display: none;" />
            <span id="edit-file-name-display" class="wa-caption-s" style="color: var(--wa-color-neutral-text-subtle);"></span>
          </div>
        </div>

        <wa-textarea
          id="edit-deck-list"
          placeholder="1 Sol Ring&#10;1 Arcane Signet&#10;..."
          rows="10"
          required
        ></wa-textarea>

        <div id="edit-parse-errors" class="wa-stack wa-gap-xs" style="display: none;">
          <!-- Parse errors will be shown here -->
        </div>
      </form>
      <div slot="footer" class="wa-cluster wa-gap-s">
        <wa-button id="btn-cancel-edit" variant="neutral" appearance="outlined">Cancel</wa-button>
        <wa-button id="btn-confirm-edit" variant="brand">Save Changes</wa-button>
      </div>
    </wa-dialog>

    <script type="module" src="app.js"></script>
  </body>
</html>
